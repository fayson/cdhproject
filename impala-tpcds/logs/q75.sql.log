/opt/cloudera/parcels/CDH-5.13.1-1.cdh5.13.1.p0.2/lib/impala-shell/ext-py/sasl-0.1.1-py2.7-linux-x86_64.egg/_saslwrapper.py:3: UserWarning: Module backports was already imported from None, but /usr/lib/python2.7/site-packages is being added to sys.path
Starting Impala Shell without Kerberos authentication
Error connecting: TTransportException, TSocket read 0 bytes
Kerberos ticket found in the credentials cache, retrying the connection with a secure transport.
Connected to ip-172-31-30-69.ap-southeast-1.compute.internal:21000
Server version: impalad version 2.10.0-cdh5.13.1 RELEASE (build 1e4b23c4eb52dac95c5be6316f49685c41783c51)
Query: use `tpcds_parquet_2`
Query: with all_sales AS (
 SELECT d_year
       ,i_brand_id
       ,i_class_id
       ,i_category_id
       ,i_manufact_id
       ,SUM(sales_cnt) AS sales_cnt
       ,SUM(sales_amt) AS sales_amt
 FROM (SELECT STRAIGHT_JOIN d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt
             ,cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt
       FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk
                          JOIN date_dim ON d_date_sk=cs_sold_date_sk
                          LEFT JOIN [ SHUFFLE ] catalog_returns ON (cs_order_number=cr_order_number
                                                    AND cs_item_sk=cr_item_sk) 
       WHERE i_category='Shoes'
	and cs_sold_date_sk between 2451180        and 2451910 
       UNION
       SELECT STRAIGHT_JOIN d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt
             ,ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt
       FROM store_sales JOIN item ON i_item_sk=ss_item_sk
                        JOIN date_dim ON d_date_sk=ss_sold_date_sk
                        LEFT JOIN [ SHUFFLE ] store_returns ON (ss_ticket_number=sr_ticket_number
                                                AND ss_item_sk=sr_item_sk) 
       WHERE i_category='Shoes'
	and ss_sold_date_sk between 2451180        and 2451910 
       UNION
       SELECT STRAIGHT_JOIN d_year
             ,i_brand_id
             ,i_class_id
             ,i_category_id
             ,i_manufact_id
             ,ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt
             ,ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt
       FROM web_sales JOIN item ON i_item_sk=ws_item_sk
                      JOIN date_dim ON d_date_sk=ws_sold_date_sk
                      LEFT JOIN [ SHUFFLE ] web_returns ON (ws_order_number=wr_order_number
                                            AND ws_item_sk=wr_item_sk )
       WHERE i_category='Shoes' 
	and ws_sold_date_sk between 2451180        and 2451910 
	) sales_detail
 GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id) 
SELECT  prev_yr.d_year AS prev_year
                          ,curr_yr.d_year AS year
                          ,curr_yr.i_brand_id
                          ,curr_yr.i_class_id
                          ,curr_yr.i_category_id
                          ,curr_yr.i_manufact_id
                          ,prev_yr.sales_cnt AS prev_yr_cnt
                          ,curr_yr.sales_cnt AS curr_yr_cnt
                          ,curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff
                          ,curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff
 FROM all_sales curr_yr, all_sales prev_yr
 WHERE curr_yr.i_brand_id=prev_yr.i_brand_id
   AND curr_yr.i_class_id=prev_yr.i_class_id
   AND curr_yr.i_category_id=prev_yr.i_category_id
   AND curr_yr.i_manufact_id=prev_yr.i_manufact_id
   AND curr_yr.d_year=2000
   AND prev_yr.d_year=2000-1
   AND (curr_yr.sales_cnt / prev_yr.sales_cnt)  <0.9
 ORDER BY sales_cnt_diff
 limit 100
1999	2000	4004001	4	4	117	15922	87	-15835	-742391.3700000001
1999	2000	4002001	2	4	707	15675	14	-15661	-663508.52
1999	2000	4002001	2	4	428	15530	85	-15445	-672172.95
1999	2000	4004001	4	4	305	15283	28	-15255	-603085.36
1999	2000	4001001	1	4	100	14965	38	-14927	-669059.1199999999
1999	2000	4004001	4	4	32	14950	199	-14751	-662975.8800000001
1999	2000	4002001	2	4	22	14610	31	-14579	-696606.1399999999
1999	2000	4003001	3	4	246	21725	7233	-14492	-675468.4599999998
1999	2000	4002001	2	4	408	14530	63	-14467	-581885.63
1999	2000	4002001	2	4	278	14497	38	-14459	-624532.9499999998
1999	2000	4001001	1	4	850	14448	111	-14337	-605742.7100000001
1999	2000	4002001	2	4	36	14383	161	-14222	-650123.3200000001
1999	2000	4002001	2	4	295	14399	292	-14107	-587026.2999999999
1999	2000	4004001	4	4	183	14111	56	-14055	-684628.1900000002
1999	2000	4003001	3	4	303	14010	113	-13897	-660399.51
1999	2000	4001001	1	4	228	13893	35	-13858	-604414.22
1999	2000	4004001	4	4	147	13575	74	-13501	-622062.75
1999	2000	4003001	3	4	200	13447	46	-13401	-487743.7300000001
1999	2000	4003001	3	4	640	13437	78	-13359	-575821.12
1999	2000	4002001	2	4	39	13128	27	-13101	-559103.41
1999	2000	4003001	3	4	173	21588	8762	-12826	-684328.7300000004
1999	2000	4001001	1	4	130	12125	101	-12024	-539276.8199999999
1999	2000	4003001	3	4	208	21808	12788	-9020	-573198.3600000001
1999	2000	4004001	4	4	257	15597	6592	-9005	-373950.15
1999	2000	4003001	3	4	320	8983	64	-8919	-446663.6700000001
1999	2000	4004001	4	4	141	15864	6960	-8904	-403534.3899999999
1999	2000	4001001	1	4	608	8924	49	-8875	-339433.17
1999	2000	4002001	2	4	218	14573	5703	-8870	-359372.83
1999	2000	4004001	4	4	155	21473	12633	-8840	-376884.4500000001
1999	2000	4002001	2	4	75	15286	6484	-8802	-343470.8799999999
1999	2000	4001001	1	4	36	16305	7533	-8772	-354143.1700000001
1999	2000	4003001	3	4	8	16549	7797	-8752	-453269.5099999998
1999	2000	4002001	2	4	535	8718	52	-8666	-433224.9500000001
1999	2000	4003001	3	4	227	15795	7341	-8454	-353920.8
1999	2000	4001001	1	4	125	8547	95	-8452	-379817.0700000001
1999	2000	4001001	1	4	300	8460	34	-8426	-364691.44
1999	2000	4001001	1	4	858	8368	16	-8352	-310378.99
1999	2000	4002001	2	4	158	8294	46	-8248	-378248.4999999999
1999	2000	4004001	4	4	318	14953	6728	-8225	-409311.7199999998
1999	2000	4003001	3	4	190	8186	43	-8143	-329397.5200000001
1999	2000	4004001	4	4	158	14933	6816	-8117	-372404.7300000001
1999	2000	4004001	4	4	813	8113	62	-8051	-337782.8900000001
1999	2000	4001001	1	4	107	8064	17	-8047	-324065.1999999999
1999	2000	4003001	3	4	505	8109	79	-8030	-334028.98
1999	2000	4003001	3	4	322	8139	109	-8030	-340718
1999	2000	4004001	4	4	306	8082	55	-8027	-337540.8900000001
1999	2000	4001001	1	4	416	8031	11	-8020	-374964.7500000001
1999	2000	4002001	2	4	287	22326	14328	-7998	-417806.8599999998
1999	2000	4002001	2	4	451	8047	76	-7971	-344584.9500000001
1999	2000	4001001	1	4	198	15000	7038	-7962	-340161.8400000001
1999	2000	4001001	1	4	45	7987	86	-7901	-352132.6
1999	2000	4001001	1	4	1	7959	68	-7891	-329651.28
1999	2000	4004001	4	4	629	7938	52	-7886	-362217.4
1999	2000	4004001	4	4	172	14918	7039	-7879	-368677.6800000002
1999	2000	4002001	2	4	642	7877	9	-7868	-365711.8700000001
1999	2000	4001001	1	4	114	13537	5682	-7855	-303794.9099999999
1999	2000	4001001	1	4	4	14187	6355	-7832	-349198.39
1999	2000	4002001	2	4	117	7850	26	-7824	-263466.3699999999
1999	2000	4001001	1	4	370	14745	6929	-7816	-311381.5799999999
1999	2000	4002001	2	4	300	7877	91	-7786	-395422.0700000001
1999	2000	4003001	3	4	454	7846	80	-7766	-311207.2700000001
1999	2000	4004001	4	4	300	7790	25	-7765	-347368.22
1999	2000	4003001	3	4	679	7802	49	-7753	-307764.59
1999	2000	4004001	4	4	460	7788	52	-7736	-305635.72
1999	2000	4004001	4	4	178	7828	99	-7729	-313857.0999999999
1999	2000	4004001	4	4	276	7807	86	-7721	-333930.4199999999
1999	2000	4001001	1	4	916	7727	29	-7698	-325140.01
1999	2000	4003001	3	4	170	7799	143	-7656	-338305.37
1999	2000	4002001	2	4	623	7703	57	-7646	-350083.6
1999	2000	4001001	1	4	288	7705	66	-7639	-294401.52
1999	2000	4004001	4	4	719	7722	91	-7631	-299598.73
1999	2000	4004001	4	4	248	7748	117	-7631	-326957.4
1999	2000	4002001	2	4	847	7657	36	-7621	-263749.9300000001
1999	2000	4002001	2	4	108	7679	69	-7610	-297413.9699999999
1999	2000	4004001	4	4	180	7660	68	-7592	-302592.61
1999	2000	4002001	2	4	485	7626	35	-7591	-344005.54
1999	2000	4001001	1	4	233	7635	82	-7553	-366569.3300000001
1999	2000	4004001	4	4	435	14118	6581	-7537	-371857.8700000001
1999	2000	4004001	4	4	303	15203	7668	-7535	-313885.5499999999
1999	2000	4002001	2	4	31	7549	16	-7533	-302272.7800000001
1999	2000	4001001	1	4	585	7594	76	-7518	-377432.56
1999	2000	4004001	4	4	350	7543	52	-7491	-293551.59
1999	2000	4003001	3	4	144	7555	66	-7489	-328571.86
1999	2000	4001001	1	4	151	7503	16	-7487	-300345.08
1999	2000	4003001	3	4	13	14780	7312	-7468	-328787.41
1999	2000	4002001	2	4	763	7601	145	-7456	-325417.59
1999	2000	4003001	3	4	295	7526	71	-7455	-326383.36
1999	2000	4002001	2	4	519	7525	93	-7432	-330692.0800000001
1999	2000	4002001	2	4	570	7545	122	-7423	-341056.16
1999	2000	4003001	3	4	528	7480	58	-7422	-318631.99
1999	2000	4001001	1	4	201	7512	91	-7421	-299121.6800000001
1999	2000	4002001	2	4	53	7426	20	-7406	-310861.82
1999	2000	4004001	4	4	335	7457	54	-7403	-284785.4800000001
1999	2000	4002001	2	4	269	7430	28	-7402	-323953.95
1999	2000	4003001	3	4	292	15537	8140	-7397	-366471.14
1999	2000	4003001	3	4	496	7474	78	-7396	-329402.14
1999	2000	4002001	2	4	40	7375	3	-7372	-378574.25
1999	2000	4001001	1	4	168	7423	63	-7360	-274346.03
1999	2000	4004001	4	4	286	14782	7425	-7357	-315195.52
1999	2000	4002001	2	4	294	7416	82	-7334	-330402.98
Fetched 100 row(s) in 6.14s
